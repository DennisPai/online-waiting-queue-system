---
alwaysApply: true
---

# Cursor 全域規範（本專案專用，Agent 必讀）

## API 與錯誤（全域）
- 新介面一律使用 `/api/v1`；舊端點保留相容期
- 回應格式：`{ success, code, message, data }`
- 錯誤碼：UNAUTHORIZED/FORBIDDEN/NOT_FOUND/CONFLICT/VALIDATION_ERROR/INTERNAL_ERROR

## 後端約定（全域）
- 新增路由放入 `/api/v1/*`（可先轉接既有 controller，再逐步統一回應）
- 變更密碼：提供 `PUT /api/v1/auth/change-password`（非強制，登入流程不鎖操作）
- 安全：`helmet`、`express-rate-limit`（`/auth/*`, `/queue/register`）、CORS 限定
- 日誌：`morgan`（dev/combined），未來改為結構化 JSON

## 前端約定（全域）
- `API_VERSION = 'v1'`（切換時統一 `/api/${API_VERSION}`）；`services/*` 一律回傳 `data`（如無 `data` 欄位則回傳原物件）
- 變更密碼為管理員可選操作，不在登入後強制彈窗
- 拆分巨型頁為元件與 hooks；表單驗證抽 schema

## 文件與提交（全域）
- 每次功能變更同步更新 `docs/PRD.md`（背景/AC）與 `docs/API_SPEC.md`
- **文檔同步工作流**：當 `docs/TODO.md` 任務狀態變更時，同步更新 `README.md` 的相關功能說明。特別是新功能開發或重構完成時，確保 README 反映最新的系統狀態。
- **需求開發流程**：新需求必須先在 `docs/PRD.md` 進行規劃與溝通確認後，再進行技術開發（API 設計、實作、測試）。Agent 須先更新 PRD 並等待確認，再執行後續開發任務。
- **任務確認機制**：TODO.md 任務標記完成前，需等用戶確認實際效果滿足需求，避免過早標記完成。
- PR 必附：變更摘要、驗收清單、回滾方式
  - 工程規範全文：即本檔（取代 `docs/ENGINEERING_RULES.md`）
  - 子領域規範：`backend-rules.mdc`、`frontend-rules.mdc`（位於 `.cursor/rules/`）

## To-Do 單一來源（全域）
- 所有重構任務以 `docs/TODO.md` 為權威清單，並同步到 Cursor 的 To-Do。
- Cursor/Agent 執行時，先讀 `docs/TODO.md` 確認當前任務，再動手改。

## 重構期間暫時規則（完成後可移除）
- 一律優先補齊 v1 端點與回應格式，舊端點保持相容，不做破壞性修改。
- 前端預設 `API_VERSION=v1`，如需回退以 `.env` 覆蓋。