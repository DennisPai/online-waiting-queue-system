# PDF ä¿®ç„å®®å•äº‹å–®å¯¦ä½œæŒ‡å—

## ğŸ¯ ç›®æ¨™
å¯¦ä½œä¿®ç„å®®å•äº‹å–®çš„ PDF ç”ŸæˆåŠŸèƒ½ï¼ŒA4 æ©«å¼é é¢åŒ…å«å…©å¼µ A5 ç›´å¼å•äº‹å–®ï¼Œæ”¯æ´é è¦½å’Œä¸‹è¼‰ã€‚

## ğŸ“„ PDF è¦æ ¼è©³ç´°

### é é¢è¦æ ¼
- **é é¢æ ¼å¼**: A4 æ©«å¼ (297Ã—210mm)
- **å•äº‹å–®å°ºå¯¸**: A5 ç›´å¼ (148Ã—210mm) 
- **ä½ˆå±€**: å·¦å³æ’åˆ—ï¼Œæ¯é å…©å¼µå•äº‹å–®
- **è£åˆ‡ç·š**: ä¸­é–“ 1mm è™›ç·š
- **é‚Šè·**: å››å‘¨å„ 5mm

### å•äº‹å–®è¨­è¨ˆçµæ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 148mmå¯¬
â”‚              ä¿®ç„å®®ç„è«‹ç¤ºå–®               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚   åœ°å€ï¼š    â”‚               â”‚
â”‚              â”‚            â”‚     å§“å      â”‚ 50mmé«˜
â”‚   è«‹ç¤ºå…§å®¹    â”‚ (å®¢æˆ¶åœ°å€)  â”‚  (å®¢æˆ¶å§“å)    â”‚
â”‚              â”‚            â”‚               â”‚
â”‚ (è«®è©¢ä¸»é¡Œ)    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚            â”‚     æ€§åˆ¥      â”‚ 25mmé«˜
â”‚              â”‚            â”‚  (å®¢æˆ¶æ€§åˆ¥)    â”‚
â”‚              â”‚   å¹´  å¹´   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚     å¹´é½¡      â”‚ 25mmé«˜
â”‚   é›»è©±ï¼š      â”‚   æœˆ  æœˆ   â”‚  (å®¢æˆ¶è™›æ­²)    â”‚
â”‚              â”‚            â”‚               â”‚
â”‚ (å®¢æˆ¶é›»è©±)    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚   è¾²æ›†å‡ºç”Ÿ     â”‚ 40mmé«˜
â”‚   å¹´ æœˆ æ—¥   â”‚   æ—¥  æ—¥   â”‚  å¹´ æœˆ æ—¥ æ™‚   â”‚
â”‚              â”‚            â”‚  (å®¢æˆ¶è¾²æ›†)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç·¨è™Ÿï¼š      â”‚   æ™‚  æ™‚   â”‚               â”‚ 25mmé«˜
â”‚ (å€™ä½è™Ÿç¢¼)    â”‚            â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### å®‰è£å¿…è¦å¥—ä»¶
```bash
npm install jspdf html2canvas
```

### 1. pdfGenerator.js æ ¸å¿ƒé‚è¼¯

```javascript
import jsPDF from 'jspdf';
import html2canvas from 'html2canvas';

/**
 * ç”Ÿæˆä¿®ç„å®®å•äº‹å–® PDF
 * @param {Array} customers - å®¢æˆ¶è³‡æ–™é™£åˆ—
 * @param {string} filename - æª”æ¡ˆåç¨±
 */
export const generateFormsPDF = async (customers, filename = 'ä¿®ç„å®®å•äº‹å–®') => {
  try {
    // ç¯©é¸ç­‰å¾…ä¸­å’Œè™•ç†ä¸­çš„å®¢æˆ¶
    const activeCustomers = customers.filter(customer => 
      customer.status === 'waiting' || customer.status === 'processing'
    );

    if (activeCustomers.length === 0) {
      throw new Error('æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å®¢æˆ¶è³‡æ–™');
    }

    // å‰µå»º PDFï¼ŒA4 æ©«å¼ (297mm x 210mm)
    const pdf = new jsPDF('landscape', 'mm', 'a4');
    
    // è¨ˆç®—éœ€è¦çš„é æ•¸ï¼Œæ¯é å…©å¼µå•äº‹å–®
    const formsPerPage = 2;
    const totalPages = Math.ceil(activeCustomers.length / formsPerPage);
    
    for (let pageIndex = 0; pageIndex < totalPages; pageIndex++) {
      if (pageIndex > 0) {
        pdf.addPage('a4', 'landscape');
      }
      
      // ç²å–ç•¶å‰é è¦è™•ç†çš„å®¢æˆ¶
      const startIndex = pageIndex * formsPerPage;
      const pageCustomers = activeCustomers.slice(startIndex, startIndex + formsPerPage);
      
      // ç”Ÿæˆç•¶å‰é çš„å•äº‹å–®
      await generatePageForms(pdf, pageCustomers, pageIndex);
    }
    
    // ä¸‹è¼‰ PDF
    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
    pdf.save(`${filename}_${timestamp}.pdf`);
    
    return true;
  } catch (error) {
    console.error('ç”ŸæˆPDFæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
    throw new Error(`ç”ŸæˆPDFæª”æ¡ˆå¤±æ•—: ${error.message}`);
  }
};

/**
 * ç”Ÿæˆå–®é çš„å•äº‹å–®å…§å®¹
 */
const generatePageForms = async (pdf, customers, pageIndex) => {
  const pageWidth = 297; // A4 æ©«å¼å¯¬åº¦
  const pageHeight = 210; // A4 æ©«å¼é«˜åº¦
  const formWidth = 148; // A5 ç›´å¼å¯¬åº¦
  const formHeight = 200; // å•äº‹å–®é«˜åº¦ï¼ˆç•™é‚Šè·ï¼‰
  const margin = 5;
  
  for (let i = 0; i < customers.length && i < 2; i++) {
    const customer = customers[i];
    const xOffset = margin + (i * (formWidth + 1)); // å·¦é‚Šå•äº‹å–®æˆ–å³é‚Šå•äº‹å–®
    const yOffset = margin;
    
    // ç”Ÿæˆå–®å¼µå•äº‹å–®
    await generateSingleForm(pdf, customer, xOffset, yOffset, formWidth, formHeight);
  }
  
  // æ·»åŠ ä¸­é–“è£åˆ‡ç·š
  if (customers.length === 2) {
    const cutLineX = margin + formWidth + 0.5;
    pdf.setLineDash([2, 2]); // è™›ç·š
    pdf.setDrawColor(128, 128, 128); // ç°è‰²
    pdf.line(cutLineX, margin, cutLineX, pageHeight - margin);
    pdf.setLineDash([]); // é‡ç½®ç·šæ¢æ¨£å¼
  }
};

/**
 * ç”Ÿæˆå–®å¼µå•äº‹å–®
 */
const generateSingleForm = async (pdf, customer, x, y, width, height) => {
  // è¨­å®šå­—é«” (ä½¿ç”¨ PDF å…§å»ºå­—é«”)
  pdf.setFont('helvetica', 'normal');
  pdf.setDrawColor(0, 0, 0); // é»‘è‰²é‚Šæ¡†
  pdf.setTextColor(0, 0, 0); // é»‘è‰²æ–‡å­—
  
  // å¤–æ¡†
  pdf.rect(x, y, width, height);
  
  // æ¨™é¡Œå€åŸŸ
  const titleHeight = 15;
  pdf.rect(x, y, width, titleHeight);
  pdf.setFontSize(16);
  pdf.text('ä¿®ç„å®®ç„è«‹ç¤ºå–®', x + width/2, y + titleHeight/2 + 3, { align: 'center' });
  
  // ä¸»è¦å…§å®¹å€åŸŸåˆ†å‰²
  const contentY = y + titleHeight;
  const contentHeight = height - titleHeight;
  
  // å·¦å´è«‹ç¤ºå…§å®¹å€åŸŸ
  const leftWidth = width * 0.4;
  const middleWidth = width * 0.25;  
  const rightWidth = width * 0.35;
  
  // å·¦å´å€åŸŸ
  pdf.rect(x, contentY, leftWidth, contentHeight);
  pdf.setFontSize(12);
  pdf.text('è«‹ç¤ºå…§å®¹', x + leftWidth/2, contentY + 15, { align: 'center' });
  
  // å¡«å…¥è«®è©¢ä¸»é¡Œ
  const consultationText = formatConsultationTopics(customer.consultationTopics, customer.otherDetails);
  pdf.setFontSize(10);
  const lines = pdf.splitTextToSize(consultationText, leftWidth - 10);
  pdf.text(lines, x + 5, contentY + 25);
  
  // ä¸­é–“å€åŸŸ (åœ°å€å’Œæ™‚é–“)
  pdf.rect(x + leftWidth, contentY, middleWidth, contentHeight);
  
  // åœ°å€å€åŸŸ
  const addressHeight = contentHeight * 0.3;
  pdf.rect(x + leftWidth, contentY, middleWidth, addressHeight);
  pdf.setFontSize(10);
  pdf.text('åœ°å€ï¼š', x + leftWidth + 2, contentY + 10);
  
  const address = getCustomerAddress(customer);
  const addressLines = pdf.splitTextToSize(address, middleWidth - 4);
  pdf.text(addressLines, x + leftWidth + 2, contentY + 18);
  
  // æ™‚é–“å€åŸŸ
  const timeY = contentY + addressHeight;
  const timeHeight = contentHeight - addressHeight;
  pdf.rect(x + leftWidth, timeY, middleWidth, timeHeight);
  
  // å¹´æœˆæ—¥æ™‚çš„æ ¼å­
  const cellHeight = timeHeight / 4;
  const cellWidth = middleWidth / 2;
  
  ['å¹´', 'æœˆ', 'æ—¥', 'æ™‚'].forEach((label, index) => {
    const cellY = timeY + (index * cellHeight);
    pdf.rect(x + leftWidth, cellY, cellWidth, cellHeight);
    pdf.rect(x + leftWidth + cellWidth, cellY, cellWidth, cellHeight);
    pdf.setFontSize(10);
    pdf.text(label, x + leftWidth + cellWidth + cellWidth/2, cellY + cellHeight/2 + 2, { align: 'center' });
  });
  
  // å³å´å€åŸŸ (å€‹äººè³‡æ–™)
  pdf.rect(x + leftWidth + middleWidth, contentY, rightWidth, contentHeight);
  
  // å§“å
  const nameHeight = contentHeight * 0.25;
  pdf.rect(x + leftWidth + middleWidth, contentY, rightWidth, nameHeight);
  pdf.setFontSize(12);
  pdf.text('å§“å', x + leftWidth + middleWidth + rightWidth/2, contentY + 8, { align: 'center' });
  pdf.setFontSize(14);
  pdf.text(customer.name, x + leftWidth + middleWidth + rightWidth/2, contentY + nameHeight - 5, { align: 'center' });
  
  // æ€§åˆ¥
  const genderY = contentY + nameHeight;
  const genderHeight = contentHeight * 0.15;
  pdf.rect(x + leftWidth + middleWidth, genderY, rightWidth, genderHeight);
  pdf.setFontSize(10);
  pdf.text('æ€§åˆ¥', x + leftWidth + middleWidth + 5, genderY + 8);
  pdf.text(customer.gender === 'male' ? 'ç”·' : 'å¥³', x + leftWidth + middleWidth + rightWidth - 15, genderY + 8);
  
  // å¹´é½¡
  const ageY = genderY + genderHeight;
  const ageHeight = contentHeight * 0.15;
  pdf.rect(x + leftWidth + middleWidth, ageY, rightWidth, ageHeight);
  pdf.text('å¹´é½¡', x + leftWidth + middleWidth + 5, ageY + 8);
  pdf.text(customer.virtualAge ? `${customer.virtualAge}æ­²` : '', x + leftWidth + middleWidth + rightWidth - 25, ageY + 8);
  
  // è¾²æ›†å‡ºç”Ÿ
  const birthY = ageY + ageHeight;
  const birthHeight = contentHeight * 0.25;
  pdf.rect(x + leftWidth + middleWidth, birthY, rightWidth, birthHeight);
  pdf.text('è¾²æ›†å‡ºç”Ÿ', x + leftWidth + middleWidth + rightWidth/2, birthY + 8, { align: 'center' });
  pdf.text('å¹´ æœˆ æ—¥ æ™‚', x + leftWidth + middleWidth + rightWidth/2, birthY + 16, { align: 'center' });
  
  const lunarDate = formatLunarDate(customer);
  pdf.setFontSize(9);
  pdf.text(lunarDate, x + leftWidth + middleWidth + rightWidth/2, birthY + birthHeight - 8, { align: 'center' });
  
  // åº•éƒ¨é›»è©±å’Œç·¨è™Ÿå€åŸŸ
  const bottomY = contentY + contentHeight * 0.8;
  const bottomHeight = contentHeight * 0.2;
  
  // é›»è©±å€åŸŸ
  pdf.rect(x, bottomY, leftWidth, bottomHeight);
  pdf.setFontSize(10);
  pdf.text('é›»è©±ï¼š', x + 5, bottomY + 8);
  pdf.text(customer.phone || '', x + 20, bottomY + 8);
  
  // å¹´æœˆæ—¥å€åŸŸ
  pdf.rect(x, bottomY + bottomHeight/2, leftWidth, bottomHeight/2);
  pdf.text('å¹´    æœˆ    æ—¥', x + leftWidth/2, bottomY + bottomHeight/2 + 8, { align: 'center' });
  
  // ç·¨è™Ÿå€åŸŸ  
  pdf.rect(x, bottomY + bottomHeight, leftWidth, bottomHeight);
  pdf.text('ç·¨è™Ÿï¼š', x + 5, bottomY + bottomHeight + 8);
  pdf.text(customer.queueNumber.toString(), x + 25, bottomY + bottomHeight + 8);
};

/**
 * æ ¼å¼åŒ–è«®è©¢ä¸»é¡Œ
 */
const formatConsultationTopics = (topics, otherDetails) => {
  if (!topics || topics.length === 0) return '';
  
  const topicMap = {
    'body': 'èº«é«”',
    'fate': 'é‹é€”', 
    'karma': 'å› æœ',
    'family': 'å®¶é‹/ç¥–å…ˆ',
    'career': 'äº‹æ¥­',
    'relationship': 'å©šå§»æ„Ÿæƒ…',
    'study': 'å­¸æ¥­',
    'blessing': 'æ”¶é©š/åŠ æŒ',
    'other': 'å…¶ä»–'
  };
  
  const translatedTopics = topics.map(topic => {
    if (topic === 'other' && otherDetails) {
      return `å…¶ä»–(${otherDetails})`;
    }
    return topicMap[topic] || topic;
  });
  
  return translatedTopics.join('ã€');
};

/**
 * æ ¼å¼åŒ–è¾²æ›†æ—¥æœŸ
 */
const formatLunarDate = (customer) => {
  if (!customer.lunarBirthYear || !customer.lunarBirthMonth || !customer.lunarBirthDay) {
    return '';
  }
  
  const minguo = customer.lunarBirthYear - 1911;
  return `æ°‘åœ‹${minguo}å¹´${customer.lunarBirthMonth}æœˆ${customer.lunarBirthDay}æ—¥`;
};

/**
 * ç²å–å®¢æˆ¶åœ°å€
 */
const getCustomerAddress = (customer) => {
  if (customer.addresses && customer.addresses.length > 0) {
    return customer.addresses[0].address;
  }
  return 'è‡¨æ™‚åœ°å€';
};
```

### 2. PDFPreviewPage.jsx

```javascript
import React, { useState, useEffect } from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import {
  Container,
  Paper,
  Typography,
  Button,
  Box,
  CircularProgress,
  Alert,
  Grid
} from '@mui/material';
import {
  FileDownload as DownloadIcon,
  ArrowBack as BackIcon,
  Print as PrintIcon
} from '@mui/icons-material';
import FormTemplate from '../components/admin/FormTemplate';
import { generateFormsPDF } from '../utils/pdfGenerator';

const PDFPreviewPage = () => {
  const location = useLocation();
  const navigate = useNavigate();
  const [customers, setCustomers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [generating, setGenerating] = useState(false);

  useEffect(() => {
    try {
      const customersData = location.state?.customers || 
                           JSON.parse(sessionStorage.getItem('exportCustomers') || '[]');
      
      if (customersData.length === 0) {
        setError('æ²’æœ‰å®¢æˆ¶è³‡æ–™å¯ä¾›é è¦½');
        setLoading(false);
        return;
      }

      // ç¯©é¸ç­‰å¾…ä¸­å’Œè™•ç†ä¸­çš„å®¢æˆ¶
      const activeCustomers = customersData.filter(customer => 
        customer.status === 'waiting' || customer.status === 'processing'
      );

      setCustomers(activeCustomers);
    } catch (err) {
      setError(`è³‡æ–™è¼‰å…¥å¤±æ•—: ${err.message}`);
    } finally {
      setLoading(false);
    }
  }, [location.state]);

  const handleDownload = async () => {
    setGenerating(true);
    try {
      await generateFormsPDF(customers, 'ä¿®ç„å®®å•äº‹å–®');
    } catch (error) {
      alert(`ä¸‹è¼‰å¤±æ•—: ${error.message}`);
    } finally {
      setGenerating(false);
    }
  };

  const handleBack = () => {
    navigate(-1);
  };

  if (loading) {
    return (
      <Container sx={{ textAlign: 'center', mt: 4 }}>
        <CircularProgress />
        <Typography sx={{ mt: 2 }}>è¼‰å…¥è³‡æ–™ä¸­...</Typography>
      </Container>
    );
  }

  if (error) {
    return (
      <Container sx={{ mt: 4 }}>
        <Alert severity="error">{error}</Alert>
        <Button onClick={handleBack} sx={{ mt: 2 }}>
          è¿”å›
        </Button>
      </Container>
    );
  }

  // è¨ˆç®—é æ•¸ï¼Œæ¯é å…©å¼µå•äº‹å–®
  const formsPerPage = 2;
  const totalPages = Math.ceil(customers.length / formsPerPage);

  return (
    <Container maxWidth="xl" sx={{ mt: 2, mb: 4 }}>
      <Box sx={{ mb: 3 }}>
        <Button
          startIcon={<BackIcon />}
          onClick={handleBack}
          sx={{ mb: 2 }}
        >
          è¿”å›ç®¡ç†é¢æ¿
        </Button>
        
        <Typography variant="h4" gutterBottom>
          ä¿®ç„å®®å•äº‹å–®é è¦½
        </Typography>
        
        <Typography variant="body2" color="text.secondary" gutterBottom>
          å…± {customers.length} ä½å®¢æˆ¶ï¼Œå°‡ç”Ÿæˆ {totalPages} é  PDFï¼ˆæ¯é  2 å¼µå•äº‹å–®ï¼‰
        </Typography>
        
        <Box sx={{ mb: 3 }}>
          <Button
            variant="contained"
            size="large"
            startIcon={generating ? <CircularProgress size={20} /> : <DownloadIcon />}
            onClick={handleDownload}
            disabled={generating}
            sx={{ mr: 2 }}
          >
            {generating ? 'ç”Ÿæˆä¸­...' : 'ä¸‹è¼‰ PDF'}
          </Button>
          
          <Button
            variant="outlined"
            startIcon={<PrintIcon />}
            onClick={() => window.print()}
          >
            é è¦½åˆ—å°
          </Button>
        </Box>
      </Box>

      {/* PDF é è¦½å€åŸŸ */}
      <Box sx={{ mb: 4 }}>
        {Array.from({ length: totalPages }, (_, pageIndex) => {
          const startIndex = pageIndex * formsPerPage;
          const pageCustomers = customers.slice(startIndex, startIndex + formsPerPage);
          
          return (
            <Paper 
              key={pageIndex}
              sx={{ 
                mb: 3, 
                p: 1,
                backgroundColor: '#f5f5f5',
                '@media print': {
                  backgroundColor: 'white',
                  boxShadow: 'none',
                  margin: 0,
                  padding: 0
                }
              }}
            >
              <Typography variant="h6" sx={{ mb: 1, '@media print': { display: 'none' } }}>
                ç¬¬ {pageIndex + 1} é 
              </Typography>
              
              <Box 
                sx={{ 
                  width: '297mm',
                  height: '210mm',
                  backgroundColor: 'white',
                  display: 'flex',
                  margin: '0 auto',
                  border: '1px solid #ddd',
                  '@media print': {
                    border: 'none',
                    width: '100%',
                    height: '100vh'
                  }
                }}
              >
                {pageCustomers.map((customer, index) => (
                  <React.Fragment key={customer._id || index}>
                    <Box sx={{ width: '148mm', height: '210mm' }}>
                      <FormTemplate customer={customer} />
                    </Box>
                    
                    {/* è£åˆ‡ç·š */}
                    {index < pageCustomers.length - 1 && (
                      <Box 
                        sx={{ 
                          width: '1mm',
                          height: '210mm',
                          borderLeft: '1px dashed #999',
                          '@media print': {
                            borderColor: '#ccc'
                          }
                        }} 
                      />
                    )}
                  </React.Fragment>
                ))}
                
                {/* å¦‚æœåªæœ‰ä¸€å¼µå•äº‹å–®ï¼Œå³å´ç•™ç©º */}
                {pageCustomers.length === 1 && (
                  <Box sx={{ width: '148mm', height: '210mm', backgroundColor: '#fafafa' }} />
                )}
              </Box>
            </Paper>
          );
        })}
      </Box>
    </Container>
  );
};

export default PDFPreviewPage;
```

### 3. FormTemplate.jsx

```javascript
import React from 'react';
import { Box, Typography, styled } from '@mui/material';

const FormContainer = styled(Box)({
  width: '148mm',
  height: '210mm',
  border: '2px solid black',
  backgroundColor: 'white',
  fontFamily: 'Arial, sans-serif',
  position: 'relative',
  padding: 0,
  margin: 0
});

const FormTitle = styled(Box)({
  height: '15mm',
  borderBottom: '2px solid black',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
  fontSize: '16px',
  fontWeight: 'bold'
});

const ContentArea = styled(Box)({
  height: 'calc(210mm - 15mm)',
  display: 'flex'
});

const LeftSection = styled(Box)({
  width: '40%',
  borderRight: '2px solid black',
  padding: '5mm',
  fontSize: '10px'
});

const MiddleSection = styled(Box)({
  width: '25%',
  borderRight: '2px solid black',
  display: 'flex',
  flexDirection: 'column'
});

const RightSection = styled(Box)({
  width: '35%',
  display: 'flex',
  flexDirection: 'column'
});

const Cell = styled(Box)(({ borderBottom = true }) => ({
  borderBottom: borderBottom ? '1px solid black' : 'none',
  padding: '2mm',
  fontSize: '10px',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center'
}));

const FormTemplate = ({ customer }) => {
  const formatConsultationTopics = (topics, otherDetails) => {
    if (!topics || topics.length === 0) return '';
    
    const topicMap = {
      'body': 'èº«é«”',
      'fate': 'é‹é€”',
      'karma': 'å› æœ', 
      'family': 'å®¶é‹/ç¥–å…ˆ',
      'career': 'äº‹æ¥­',
      'relationship': 'å©šå§»æ„Ÿæƒ…',
      'study': 'å­¸æ¥­',
      'blessing': 'æ”¶é©š/åŠ æŒ',
      'other': 'å…¶ä»–'
    };
    
    const translatedTopics = topics.map(topic => {
      if (topic === 'other' && otherDetails) {
        return `å…¶ä»–(${otherDetails})`;
      }
      return topicMap[topic] || topic;
    });
    
    return translatedTopics.join('ã€');
  };

  const formatLunarDate = () => {
    if (!customer.lunarBirthYear || !customer.lunarBirthMonth || !customer.lunarBirthDay) {
      return '';
    }
    
    const minguo = customer.lunarBirthYear - 1911;
    return `æ°‘åœ‹${minguo}å¹´${customer.lunarBirthMonth}æœˆ${customer.lunarBirthDay}æ—¥`;
  };

  const getAddress = () => {
    if (customer.addresses && customer.addresses.length > 0) {
      return customer.addresses[0].address;
    }
    return 'è‡¨æ™‚åœ°å€';
  };

  return (
    <FormContainer>
      <FormTitle>
        ä¿®ç„å®®ç„è«‹ç¤ºå–®
      </FormTitle>
      
      <ContentArea>
        {/* å·¦å´è«‹ç¤ºå…§å®¹å€åŸŸ */}
        <LeftSection>
          <Box sx={{ textAlign: 'center', mb: 1, fontWeight: 'bold' }}>
            è«‹ç¤ºå…§å®¹
          </Box>
          <Box sx={{ fontSize: '9px', lineHeight: 1.4 }}>
            {formatConsultationTopics(customer.consultationTopics, customer.otherDetails)}
          </Box>
          
          {/* åº•éƒ¨é›»è©±å’Œç·¨è™Ÿ */}
          <Box sx={{ position: 'absolute', bottom: '30mm', left: '5mm', right: '60%' }}>
            <Box sx={{ borderTop: '1px solid black', pt: 1, mb: 1 }}>
              é›»è©±ï¼š{customer.phone || ''}
            </Box>
            <Box sx={{ borderTop: '1px solid black', pt: 1, mb: 1 }}>
              å¹´ã€€ã€€æœˆã€€ã€€æ—¥
            </Box>
            <Box sx={{ borderTop: '1px solid black', pt: 1 }}>
              ç·¨è™Ÿï¼š{customer.queueNumber}
            </Box>
          </Box>
        </LeftSection>

        {/* ä¸­é–“å€åŸŸ */}
        <MiddleSection>
          {/* åœ°å€å€åŸŸ */}
          <Box sx={{ height: '30%', borderBottom: '1px solid black', p: 1 }}>
            <Typography variant="caption" sx={{ fontSize: '8px' }}>
              åœ°å€ï¼š
            </Typography>
            <Typography variant="caption" sx={{ fontSize: '8px', display: 'block', mt: 0.5 }}>
              {getAddress()}
            </Typography>
          </Box>
          
          {/* å¹´æœˆæ—¥æ™‚æ ¼å­ */}
          <Box sx={{ height: '70%' }}>
            {['å¹´', 'æœˆ', 'æ—¥', 'æ™‚'].map((label, index) => (
              <Box key={label} sx={{ height: '25%', display: 'flex' }}>
                <Cell sx={{ width: '50%', borderRight: '1px solid black' }}>
                  {label}
                </Cell>
                <Cell sx={{ width: '50%' }}>
                  {label}
                </Cell>
              </Box>
            ))}
          </Box>
        </MiddleSection>

        {/* å³å´å€‹äººè³‡æ–™å€åŸŸ */}
        <RightSection>
          {/* å§“å */}
          <Cell sx={{ height: '25%', fontSize: '12px', fontWeight: 'bold' }}>
            <Box>
              <Typography variant="caption" sx={{ fontSize: '10px' }}>å§“å</Typography>
              <Typography sx={{ fontSize: '14px', mt: 0.5 }}>{customer.name}</Typography>
            </Box>
          </Cell>
          
          {/* æ€§åˆ¥ */}
          <Cell sx={{ height: '15%' }}>
            æ€§åˆ¥ï¼š{customer.gender === 'male' ? 'ç”·' : 'å¥³'}
          </Cell>
          
          {/* å¹´é½¡ */}
          <Cell sx={{ height: '15%' }}>
            å¹´é½¡ï¼š{customer.virtualAge ? `${customer.virtualAge}æ­²` : ''}
          </Cell>
          
          {/* è¾²æ›†å‡ºç”Ÿ */}
          <Cell sx={{ height: '25%', flexDirection: 'column', borderBottom: false }}>
            <Typography variant="caption" sx={{ fontSize: '9px' }}>
              è¾²æ›†å‡ºç”Ÿå¹´æœˆæ—¥æ™‚
            </Typography>
            <Typography sx={{ fontSize: '8px', mt: 0.5 }}>
              {formatLunarDate()}
            </Typography>
          </Cell>
          
          {/* ç©ºç™½å€åŸŸ */}
          <Box sx={{ height: '20%' }} />
        </RightSection>
      </ContentArea>
    </FormContainer>
  );
};

export default FormTemplate;
```

## ğŸ”„ æ•´åˆåˆ° ExportDialog

åœ¨ ExportDialog.jsx ä¸­æ–°å¢ PDF é¸é …ï¼š

```javascript
<FormControlLabel 
  value="forms" 
  control={<Radio />} 
  label={
    <Box display="flex" alignItems="center">
      <DescriptionIcon sx={{ mr: 1 }} />
      ä¿®ç„å®®å•äº‹å–® (PDF)
    </Box>
  } 
/>
```

ä¸¦åœ¨ handleExport ä¸­åŠ å…¥ï¼š

```javascript
if (exportFormat === 'forms') {
  // æ–°é–‹é é¢é è¦½
  window.open('/admin/pdf-preview', '_blank');
  sessionStorage.setItem('exportCustomers', JSON.stringify(customers));
  onClose();
  return;
}
```

## âœ… æ¸¬è©¦æª¢æŸ¥é»

1. **PDF ä½ˆå±€**: ç¢ºèª A4 æ©«å¼åŒ…å«å…©å¼µ A5 ç›´å¼å•äº‹å–®
2. **è£åˆ‡ç·š**: é©—è­‰ä¸­é–“è™›ç·šæ­£ç¢ºé¡¯ç¤º
3. **è³‡æ–™å¡«å…¥**: æª¢æŸ¥æ‰€æœ‰å®¢æˆ¶è³‡æ–™æ­£ç¢ºå°æ‡‰åˆ°å•äº‹å–®æ¬„ä½
4. **è¾²æ›†æ—¥æœŸ**: æ¸¬è©¦å„ç¨®æ—¥æœŸæ ¼å¼å’Œç©ºå€¼è™•ç†
5. **åˆ—å°æ¸¬è©¦**: å¯¦éš›åˆ—å°æ¸¬è©¦ç¢ºèªå°ºå¯¸å’Œä½ˆå±€æ­£ç¢º
6. **é è¦½åŠŸèƒ½**: ç¢ºèªé è¦½é é¢æ­£ç¢ºé¡¯ç¤ºæ‰€æœ‰å•äº‹å–®
